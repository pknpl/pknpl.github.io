<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Set</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <img src="assets/logo.jpg" alt="Logo" class="logo">
        </div>
        <div class="header-center">
            <h1 id="role-title">Sets</h1>
        </div>
        <div class="header-right">
            <div class="user-badge">
                <strong>ALC ID</strong>
                <span id="header-user-id">--</span>
            </div>
            <button onclick="openHelp()" class="btn-icon" style="margin-right:5px;">?</button>
            <button onclick="logout()" class="btn-logout">Logout</button>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <p id="loading-msg" style="text-align:center; color: var(--text-muted);">Scanning...</p>
            <div id="sets-grid" class="grid-menu"></div>
            <p id="no-sets-msg" style="text-align:center; color: red; display: none;">No sets found.</p>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="history.back()" class="btn btn-outline" style="width: auto; padding: 10px 30px;">Back</button>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script>
        const user = checkSession();
        const params = new URLSearchParams(window.location.search);
        const role = params.get('role') || 'cc';
        
        // Dynamic Title
        if (role === 'alc') {
            document.getElementById('role-title').innerText = "ALC Revision Sets";
        } else {
            document.getElementById('role-title').innerText = role === 'cc' ? "Coordinator Sets" : "Facilitator Sets";
        }
        
        const grid = document.getElementById('sets-grid');
        const MAX_SETS = 50;
        let found = 0, checked = 0;

        for(let i = 1; i <= MAX_SETS; i++) {
            const btn = document.createElement('a');
            btn.className = 'btn btn-outline';
            btn.innerText = `Set ${i}`;
            
            // --- INTELLIGENT ROUTING ---
            if (role === 'alc') {
                // ALC goes to Study Page first
                btn.href = `study.html?set=${i}`;
            } else {
                // Others go straight to Quiz
                btn.href = `quiz.html?role=${role}&set=${i}`;
            }
            // ---------------------------

            btn.style.display = 'none';
            btn.id = `btn-${i}`;
            grid.appendChild(btn);

            // Check if file exists
            fetch(`data/${role}/set${i}.json`, { method: 'HEAD' })
                .then(res => { if(res.ok) { document.getElementById(`btn-${i}`).style.display = 'inline-block'; found++; } })
                .finally(() => {
                    checked++;
                    if(checked === MAX_SETS) {
                        document.getElementById('loading-msg').style.display = 'none';
                        if(found === 0) document.getElementById('no-sets-msg').style.display = 'block';
                    }
                });
        }
    </script>
</body>
</html>